  - name: Setup Python
    uses: actions/setup-python@v4
    with:
      python-version: '3.x'

  - name: Install dependencies
    run: |
      pip install requests yfinance

  - name: Fetch Top50 tickers
    run: |
      python fetch_top50.py --count 50 --output top50.json --region JP

  - name: Update stocks.json
    run: |
      python update_stocks.py --top top50.json --output stocks.json --sleep 1

  - name: Commit and push changes
    run: |
      git config user.name "github-actions[bot]"
      git config user.email "github-actions[bot]@users.noreply.github.com"
      git add top50.json stocks.json
      git diff --quiet || (
        git commit -m "chore: update Top50 list and stocks.json"
        git push
      )
